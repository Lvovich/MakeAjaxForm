/**
 * @file MakeAJAXForm
 * @version 3.3
 *
 * @author Lvovich
 * @see {@link https://github.com/Lvovich/MakeAjaxForm|GitHub}
 *
 * @copyright none|Free code.
 */
'use strict';window.MakeAjaxForm=function(a){if("object"!==typeof this||this===window)return console.error('makeAjaxForm: incorrect call without "new". Plugin Off!'),{};a.target=""+a.target||"/";if(!a.container||!a.submit)return console.error('MakeAjaxForm: parameters "container" or "submit" is invalid. Plugin Off!'),{};"function"!==typeof a.onBeforeExchange&&(a.onBeforeExchange=function(){});"function"!==typeof a.onExchangeSuccess&&(a.onExchangeSuccess=function(){console.warn('MakeAjaxForm: parameter "onExchangeSuccess" is not a function')});
"function"!==typeof a.onExchangeError&&(a.onExchangeError=function(){console.warn('MakeAjaxForm: parameter "onExchangeError" is not a function')});"function"!==typeof a.onValidationError&&(a.onValidationError=function(){console.warn('MakeAjaxForm: parameter "onValidationError" is not a function')});return function(d){d.g=a.container;d.f=a.submit;d.f.addEventListener("click",function(){var c=new XMLHttpRequest,b=d.h(),f=d.j(b,a);if(!1===f)return!1;var e=setTimeout(function(){c.abort();a.onExchangeError("No server response for a long times. Exchange aborted. Try to reload the page.")},
3E4);c.open("post",a.target,!0);c.onreadystatechange=function(){if(4==c.readyState)if(clearTimeout(e),200==c.status)a.onExchangeSuccess(c.responseText);else a.onExchangeError(c.status+": "+c.statusText)};b=d.i(b,f.formData,a);b.b.length&&c.setRequestHeader("Content-Type","multipart/form-data; boundary="+b.b);c.send(b.data)})}(this)};(function(a){function d(b,a,c){c=c||[];var d=Object.create(null);d.name=b;d.value=a;d.c=c;return d}function c(b,a){var c=Object.create(null);c.element=b;c.type=a;return c}a.a=Object.create(null);a.a.input=function(b){var a=[],e=[];!b.value||b.disabled?b.hasAttribute("required")&&e.push(c(b,"required_wo_value")):"checkbox"===b.type||"radio"===b.type?b.checked?a.push(d(b.name,b.value,[])):b.hasAttribute("required")&&e.push(c(b,"required_wo_check")):"file"===b.type?a.push(d(b.name,b.value,b.files)):
a.push(d(b.name,b.value,[]));return{data:a,valid:e}};a.a.select=function(b){var a=[],e=[];if(!b.disabled){for(var h=0,k=b.options.length;h<k;h++){var g=b.options[h];!g.disabled&&g.selected&&g.value&&a.push(d(b.name,g.value,[]))}b.hasAttribute("required")&&!a.length&&e.push(c(b,"required_wo_check"))}return{data:a,valid:e}};a.a.textarea=function(b){var a=[],e=[];!b.value||b.disabled?b.hasAttribute("required")&&e.push(c(b,"required_wo_value")):a.push(d(b.name,b.value,[]));return{data:a,valid:e}}})(window.MakeAjaxForm.prototype);(function(a){a.h=function(){var a=[],c=[],b=["input","select","textarea"];(function(f){b.forEach(function(b){if(b in f.a)for(var h=f.g.querySelectorAll(b),k=0,g=h.length;k<g;k++){var l=h[k];l!==f.f&&l.name&&(l=f.a[b](l),a=a.concat(l.data),c=c.concat(l.valid))}})})(this);return{data:a,validationErrors:c}}})(window.MakeAjaxForm.prototype);(function(a){a.j=function(a,c){var b=Object.create(null);if(!1===c.onBeforeExchange(a))return!1;if(0<a.validationErrors.length)return a.validationErrors.forEach(function(a){c.onValidationError(a)}),!1;if(0===a.data.length)return c.onExchangeError("no_valid_data"),!1;b.formData=window.FormData?new FormData:!1;return b}})(window.MakeAjaxForm.prototype);(function(a){a.i=function(a,c,b){var f=Object.create(null);if(c)a.data.forEach(function(a){c.append(a.name,a.c.length?a.c[0]:a.value)}),f.b="",f.data=c;else{var e="maf"+(""+Math.random()).slice(2,18),h="--"+e+"\r\n",k="--"+e+"--\r\n",g=["\r\n"];a.data.forEach(function(a){if(a.c.length)b.onExchangeError("file_exchange_disabled");else g.push('Content-Disposition: form-data; name="'+a.name+'"\r\n\r\n'+a.value+"\r\n")});f.b=e;f.data=g.join(h)+k}return f}})(window.MakeAjaxForm.prototype);
