/**
 * @file MakeAJAXForm
 * @version 4.7
 *
 * @author Lvovich
 * @see {@link https://github.com/Lvovich/MakeAjaxForm|GitHub}
 *
 * @license MIT
 */
'use strict';window.MakeAjaxForm=function(a){if("object"!==typeof this||this===window)return console.error('makeAjaxForm: incorrect call without "new". Plugin Off!'),{};a.target=""+a.target||"/";a.waitingtime=+a.waitingtime?+a.waitingtime:3600;a.stopOnInvalid=void 0!==a.stopOnInvalid?!!a.stopOnInvalid:!0;if(!a.container||!a.submit)return console.error('MakeAjaxForm: parameters "container" or "submit" is invalid. Plugin Off!'),{};"function"!==typeof a.onDataCollected&&(a.onDataCollected=function(){});
"function"!==typeof a.onValidationError&&(a.onValidationError=function(){});"function"!==typeof a.onStartExchange&&(a.onStartExchange=function(){});"function"!==typeof a.onExchangeError&&(a.onExchangeError=function(){});"function"!==typeof a.onExchangeSuccess&&(a.onExchangeSuccess=function(){});return function(f){function e(){var b=new XMLHttpRequest,d=f.g();if(!f.i(d,a))return!1;var c=setTimeout(function(){b.abort();a.onExchangeError("No server response for a long times. Exchange aborted.")},1E3*
a.waitingtime);b.open("post",a.target,!0);b.onreadystatechange=function(){if(4===b.readyState)if(clearTimeout(c),200===b.status)a.onExchangeSuccess(b.responseText);else a.onExchangeError(b.status+": "+b.statusText)};d=f.h(d,a);d.c.length&&b.setRequestHeader("Content-Type","multipart/form-data; boundary="+d.c);b.send(d.data)}f.f=a.container;f.a=a.submit;f.a.addEventListener?f.a.addEventListener("click",e):f.a.attachEvent&&f.a.attachEvent("onclick",e)}(this)};
(function(a){function f(b){return{element:b,fileData:b.files||[]}}function e(b,a){return{element:b,type:a}}a.b={};a.b.input=function(b){var a=[],c=[];!b.hasAttribute("required")||b.value&&!b.disabled?"checkbox"===b.type||"radio"===b.type?b.checked?a.push(f(b)):b.hasAttribute("required")&&c.push(e(b,"required_wo_check")):a.push(f(b)):c.push(e(b,"required_wo_value"));return{data:a,valid:c}};a.b.select=function(b){var a=[],c=[];if(!b.disabled){for(var h=0,g=b.options.length;h<g;h++){var k=b.options[h];
!k.disabled&&k.selected&&k.value&&a.push(f(b))}b.hasAttribute("required")&&!a.length&&c.push(e(b,"required_wo_check"))}return{data:a,valid:c}};a.b.textarea=function(a){var d=[],c=[];!a.hasAttribute("required")||a.value&&!a.disabled?d.push(f(a)):c.push(e(a,"required_wo_value"));return{data:d,valid:c}}})(window.MakeAjaxForm.prototype);
(function(a){a.g=function(){var a=[],e=[],b=["input","select","textarea"],d,c,h,g,k,l;d=0;for(c=b.length;d<c;d++){k=b[d];var m=this.f.querySelectorAll(k);h=0;for(g=m.length;h<g;h++)l=m[h],l!==this.a&&l.name&&(l=this.b[k](l),a=a.concat(l.data),e=e.concat(l.valid))}return{data:a,validationErrors:e}}})(window.MakeAjaxForm.prototype);
(function(a){a.i=function(a,e){return!1===e.onDataCollected(a)?!1:0<a.validationErrors.length&&e.stopOnInvalid?(e.onValidationError(a.validationErrors),!1):!1===e.onStartExchange()?!1:0===a.data.length?(e.onExchangeError("no_valid_data"),!1):!0}})(window.MakeAjaxForm.prototype);
(function(a){a.h=function(a,e){var b={},d=window.FormData?new window.FormData:!1,c,h,g;if(d){c=0;for(h=a.data.length;c<h;c++)g=a.data[c],e=g.fileData.length?g.fileData[0]:g.element.value,d.append(g.element.name,e);b.c="";b.data=d}else{var d="maf"+(""+Math.random()).slice(2,18),k="--"+d+"\r\n",l="--"+d+"--\r\n",m=["\r\n"];c=0;for(h=a.data.length;c<h;c++)if(g=a.data[c],g.fileData.length)e.onExchangeError("file_exchange_disabled");else m.push('Content-Disposition: form-data; name="'+g.element.name+'"\r\n\r\n'+
g.element.value+"\r\n");b.c=d;b.data=m.join(k)+l}return b}})(window.MakeAjaxForm.prototype);
