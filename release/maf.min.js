/**
 * @file MakeAJAXForm
 * @version 4.3
 *
 * @author Lvovich
 * @see {@link https://github.com/Lvovich/MakeAjaxForm|GitHub}
 *
 * @copyright none|Free code.
 */
'use strict';window.MakeAjaxForm=function(a){if("object"!==typeof this||this===window)return console.error('makeAjaxForm: incorrect call without "new". Plugin Off!'),{};a.target=""+a.target||"/";a.waitingtime=+a.waitingtime?+a.waitingtime:3600;if(!a.container||!a.submit)return console.error('MakeAjaxForm: parameters "container" or "submit" is invalid. Plugin Off!'),{};"function"!==typeof a.onDataCollected&&(a.onDataCollected=function(){});"function"!==typeof a.onValidationError&&(a.onValidationError=
function(){});"function"!==typeof a.onStartExchange&&(a.onStartExchange=function(){});"function"!==typeof a.onExchangeError&&(a.onExchangeError=function(){});"function"!==typeof a.onExchangeSuccess&&(a.onExchangeSuccess=function(){});return function(f){f.f=a.container;f.c=a.submit;f.c.addEventListener("click",function(){var b=new XMLHttpRequest,d=f.g(),c=f.i(d,a);if(!1===c)return!1;var e=setTimeout(function(){b.abort();a.onExchangeError("No server response for a long times. Exchange aborted. Try to reload the page.")},
1E3*a.waitingtime);b.open("post",a.target,!0);b.onreadystatechange=function(){if(4==b.readyState)if(clearTimeout(e),200==b.status)a.onExchangeSuccess(b.responseText);else a.onExchangeError(b.status+": "+b.statusText)};d=f.h(d,c.formData,a);d.b.length&&b.setRequestHeader("Content-Type","multipart/form-data; boundary="+d.b);b.send(d.data)})}(this)};
(function(a){function f(d){var a=Object.create(null);a.element=d;a.fileData=d.files||[];return a}function b(d,a){var b=Object.create(null);b.element=d;b.type=a;return b}a.a=Object.create(null);a.a.input=function(a){var c=[],e=[];!a.hasAttribute("required")||a.value&&!a.disabled?"checkbox"===a.type||"radio"===a.type?a.checked?c.push(f(a)):a.hasAttribute("required")&&e.push(b(a,"required_wo_check")):c.push(f(a)):e.push(b(a,"required_wo_value"));return{data:c,valid:e}};a.a.select=function(a){var c=[],
e=[];if(!a.disabled){for(var l=0,h=a.options.length;l<h;l++){var g=a.options[l];!g.disabled&&g.selected&&g.value&&c.push(f(a))}a.hasAttribute("required")&&!c.length&&e.push(b(a,"required_wo_check"))}return{data:c,valid:e}};a.a.textarea=function(a){var c=[],e=[];!a.hasAttribute("required")||a.value&&!a.disabled?c.push(f(a)):e.push(b(a,"required_wo_value"));return{data:c,valid:e}}})(window.MakeAjaxForm.prototype);
(function(a){a.g=function(){var a=[],b=[],d=["input","select","textarea"];(function(c){d.forEach(function(e){if(e in c.a)for(var d=c.f.querySelectorAll(e),h=0,g=d.length;h<g;h++){var k=d[h];k!==c.c&&k.name&&(k=c.a[e](k),a=a.concat(k.data),b=b.concat(k.valid))}})})(this);return{data:a,validationErrors:b}}})(window.MakeAjaxForm.prototype);
(function(a){a.i=function(a,b){var d=Object.create(null);if(!1===b.onDataCollected(a))return!1;if(0<a.validationErrors.length)return a.validationErrors.forEach(function(a){b.onValidationError(a)}),!1;if(!1===b.onStartExchange())return!1;if(0===a.data.length)return b.onExchangeError("no_valid_data"),!1;d.formData=window.FormData?new FormData:!1;return d}})(window.MakeAjaxForm.prototype);
(function(a){a.h=function(a,b,d){var c=Object.create(null);if(b)a.data.forEach(function(a){b.append(a.element.name,a.fileData.length?a.fileData[0]:a.element.value)}),c.b="",c.data=b;else{var e="maf"+(""+Math.random()).slice(2,18),l="--"+e+"\r\n",h="--"+e+"--\r\n",g=["\r\n"];a.data.forEach(function(a){if(a.fileData.length)d.onExchangeError("file_exchange_disabled");else g.push('Content-Disposition: form-data; name="'+a.element.name+'"\r\n\r\n'+a.element.value+"\r\n")});c.b=e;c.data=g.join(l)+h}return c}})(window.MakeAjaxForm.prototype);
