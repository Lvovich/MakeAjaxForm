/**
 * @file MakeAJAXForm
 * @version 4.5
 *
 * @author Lvovich
 * @see {@link https://github.com/Lvovich/MakeAjaxForm|GitHub}
 *
 * @license MIT
 */
'use strict';window.MakeAjaxForm=function(a){if("object"!==typeof this||this===window)return console.error('makeAjaxForm: incorrect call without "new". Plugin Off!'),{};a.target=""+a.target||"/";a.waitingtime=+a.waitingtime?+a.waitingtime:3600;if(!a.container||!a.submit)return console.error('MakeAjaxForm: parameters "container" or "submit" is invalid. Plugin Off!'),{};"function"!==typeof a.onDataCollected&&(a.onDataCollected=function(){});"function"!==typeof a.onValidationError&&(a.onValidationError=
function(){});"function"!==typeof a.onStartExchange&&(a.onStartExchange=function(){});"function"!==typeof a.onExchangeError&&(a.onExchangeError=function(){});"function"!==typeof a.onExchangeSuccess&&(a.onExchangeSuccess=function(){});return function(g){function c(){var b=new XMLHttpRequest,e=g.g(),c=g.i(e,a);if(!1===c)return!1;var f=setTimeout(function(){b.abort();a.onExchangeError("No server response for a long times. Exchange aborted. Try to reload the page.")},1E3*a.waitingtime);b.open("post",
a.target,!0);b.onreadystatechange=function(){if(4===b.readyState)if(clearTimeout(f),200===b.status)a.onExchangeSuccess(b.responseText);else a.onExchangeError(b.status+": "+b.statusText)};e=g.h(e,c.formData,a);e.c.length&&b.setRequestHeader("Content-Type","multipart/form-data; boundary="+e.c);b.send(e.data)}g.f=a.container;g.a=a.submit;g.a.addEventListener?g.a.addEventListener("click",c):g.a.attachEvent&&g.a.attachEvent("onclick",c)}(this)};
(function(a){function g(b){return{element:b,fileData:b.files||[]}}function c(b,a){return{element:b,type:a}}a.b={};a.b.input=function(b){var a=[],d=[];!b.hasAttribute("required")||b.value&&!b.disabled?"checkbox"===b.type||"radio"===b.type?b.checked?a.push(g(b)):b.hasAttribute("required")&&d.push(c(b,"required_wo_check")):a.push(g(b)):d.push(c(b,"required_wo_value"));return{data:a,valid:d}};a.b.select=function(b){var a=[],d=[];if(!b.disabled){for(var f=0,h=b.options.length;f<h;f++){var k=b.options[f];
!k.disabled&&k.selected&&k.value&&a.push(g(b))}b.hasAttribute("required")&&!a.length&&d.push(c(b,"required_wo_check"))}return{data:a,valid:d}};a.b.textarea=function(b){var a=[],d=[];!b.hasAttribute("required")||b.value&&!b.disabled?a.push(g(b)):d.push(c(b,"required_wo_value"));return{data:a,valid:d}}})(window.MakeAjaxForm.prototype);
(function(a){a.g=function(){var a=[],c=[],b=["input","select","textarea"],e,d,f,h,k,l;e=0;for(d=b.length;e<d;e++){k=b[e];var m=this.f.querySelectorAll(k);f=0;for(h=m.length;f<h;f++)l=m[f],l!==this.a&&l.name&&(l=this.b[k](l),a=a.concat(l.data),c=c.concat(l.valid))}return{data:a,validationErrors:c}}})(window.MakeAjaxForm.prototype);
(function(a){a.i=function(a,c){var b={},e;if(!1===c.onDataCollected(a))return!1;if(0<a.validationErrors.length){b=0;for(e=a.validationErrors.length;b<e;b++)c.onValidationError(a.validationErrors[b]);return!1}if(!1===c.onStartExchange())return!1;if(0===a.data.length)return c.onExchangeError("no_valid_data"),!1;b.formData=window.FormData?new FormData:!1;return b}})(window.MakeAjaxForm.prototype);
(function(a){a.h=function(a,c,b){var e={},d,f,h;if(c){d=0;for(f=a.data.length;d<f;d++)h=a.data[d],b=h.fileData.length?h.fileData[0]:h.element.value,c.append(h.element.name,b);e.c="";e.data=c}else{c="maf"+(""+Math.random()).slice(2,18);var k="--"+c+"\r\n",l="--"+c+"--\r\n",m=["\r\n"];d=0;for(f=a.data.length;d<f;d++)if(h=a.data[d],h.fileData.length)b.onExchangeError("file_exchange_disabled");else m.push('Content-Disposition: form-data; name="'+h.element.name+'"\r\n\r\n'+h.element.value+"\r\n");e.c=
c;e.data=m.join(k)+l}return e}})(window.MakeAjaxForm.prototype);
