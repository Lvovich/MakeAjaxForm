/**
 * @file MakeAJAXForm
 * @version 4.2
 *
 * @author Lvovich
 * @see {@link https://github.com/Lvovich/MakeAjaxForm|GitHub}
 *
 * @copyright none|Free code.
 */
'use strict';window.MakeAjaxForm=function(a){if("object"!==typeof this||this===window)return console.error('makeAjaxForm: incorrect call without "new". Plugin Off!'),{};a.target=""+a.target||"/";if(!a.container||!a.submit)return console.error('MakeAjaxForm: parameters "container" or "submit" is invalid. Plugin Off!'),{};"function"!==typeof a.onDataCollected&&(a.onDataCollected=function(){});"function"!==typeof a.onValidationError&&(a.onValidationError=function(){});"function"!==typeof a.onStartExchange&&
(a.onStartExchange=function(){});"function"!==typeof a.onExchangeError&&(a.onExchangeError=function(){});"function"!==typeof a.onExchangeSuccess&&(a.onExchangeSuccess=function(){});return function(f){f.f=a.container;f.c=a.submit;f.c.addEventListener("click",function(){var c=new XMLHttpRequest,b=f.g(),d=f.i(b,a);if(!1===d)return!1;var e=setTimeout(function(){c.abort();a.onExchangeError("No server response for a long times. Exchange aborted. Try to reload the page.")},3E4);c.open("post",a.target,!0);
c.onreadystatechange=function(){if(4==c.readyState)if(clearTimeout(e),200==c.status)a.onExchangeSuccess(c.responseText);else a.onExchangeError(c.status+": "+c.statusText)};b=f.h(b,d.formData,a);b.b.length&&c.setRequestHeader("Content-Type","multipart/form-data; boundary="+b.b);c.send(b.data)})}(this)};
(function(a){function f(b){var a=Object.create(null);a.element=b;a.fileData=b.files||[];return a}function c(b,a){var c=Object.create(null);c.element=b;c.type=a;return c}a.a=Object.create(null);a.a.input=function(b){var a=[],e=[];!b.hasAttribute("required")||b.value&&!b.disabled?"checkbox"===b.type||"radio"===b.type?b.checked?a.push(f(b)):b.hasAttribute("required")&&e.push(c(b,"required_wo_check")):a.push(f(b)):e.push(c(b,"required_wo_value"));return{data:a,valid:e}};a.a.select=function(a){var d=[],
e=[];if(!a.disabled){for(var g=0,k=a.options.length;g<k;g++){var h=a.options[g];!h.disabled&&h.selected&&h.value&&d.push(f(a))}a.hasAttribute("required")&&!d.length&&e.push(c(a,"required_wo_check"))}return{data:d,valid:e}};a.a.textarea=function(a){var d=[],e=[];!a.hasAttribute("required")||a.value&&!a.disabled?d.push(f(a)):e.push(c(a,"required_wo_value"));return{data:d,valid:e}}})(window.MakeAjaxForm.prototype);
(function(a){a.g=function(){var a=[],c=[],b=["input","select","textarea"];(function(d){b.forEach(function(b){if(b in d.a)for(var g=d.f.querySelectorAll(b),k=0,h=g.length;k<h;k++){var l=g[k];l!==d.c&&l.name&&(l=d.a[b](l),a=a.concat(l.data),c=c.concat(l.valid))}})})(this);return{data:a,validationErrors:c}}})(window.MakeAjaxForm.prototype);
(function(a){a.i=function(a,c){var b=Object.create(null);if(!1===c.onDataCollected(a))return!1;if(0<a.validationErrors.length)return a.validationErrors.forEach(function(a){c.onValidationError(a)}),!1;if(!1===c.onStartExchange())return!1;if(0===a.data.length)return c.onExchangeError("no_valid_data"),!1;b.formData=window.FormData?new FormData:!1;return b}})(window.MakeAjaxForm.prototype);
(function(a){a.h=function(a,c,b){var d=Object.create(null);if(c)a.data.forEach(function(a){c.append(a.element.name,a.fileData.length?a.fileData[0]:a.element.value)}),d.b="",d.data=c;else{var e="maf"+(""+Math.random()).slice(2,18),g="--"+e+"\r\n",k="--"+e+"--\r\n",h=["\r\n"];a.data.forEach(function(a){if(a.fileData.length)b.onExchangeError("file_exchange_disabled");else h.push('Content-Disposition: form-data; name="'+a.element.name+'"\r\n\r\n'+a.element.value+"\r\n")});d.b=e;d.data=h.join(g)+k}return d}})(window.MakeAjaxForm.prototype);
